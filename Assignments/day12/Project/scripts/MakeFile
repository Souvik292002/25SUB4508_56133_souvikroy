# ===============================
# 1. Compiler and Flags
# ===============================
CC      := gcc
CFLAGS  := -g -Wall -Wextra
LDFLAGS :=

# ===============================
# 2. Directories
# ===============================
SRC_DIR := ../src
OBJ_DIR := ../obj
BIN_DIR := ../bin

# ===============================
# 3. File Discovery
# ===============================
SRCS := $(wildcard $(SRC_DIR)/*.c)
BINS := $(patsubst $(SRC_DIR)/%.c, $(BIN_DIR)/%, $(SRCS))

# ===============================
# 4. Default Rule
# ===============================
all: $(BINS)

# ===============================
# 5. Link Object â†’ Binary
# ===============================
$(BIN_DIR)/%: $(OBJ_DIR)/%.o | $(BIN_DIR)
	$(CC) $< -o $@ $(LDFLAGS)
	@echo "âœ” Created binary: $@"

# ===============================
# 6. Compile Source â†’ Object
# ===============================
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c | $(OBJ_DIR)
	$(CC) $(CFLAGS) -c $< -o $@
	@echo "âœ” Compiled: $<"

# ===============================
# 7. Directory Creation
# ===============================
$(BIN_DIR) $(OBJ_DIR):
	mkdir -p $@

# ===============================
# 8. Run a Specific Program
# Usage: make run name=p1
# ===============================
run:
	@if [ -z "$(name)" ]; then \
		echo "âŒ Usage: make run name=<program_name>"; \
	else \
		$(BIN_DIR)/$(name); \
	fi

# ===============================
# 9. Clean
# ===============================
clean:
	rm -rf $(OBJ_DIR) $(BIN_DIR)
	@echo "ðŸ§¹ Cleaned all binaries and objects."

.PHONY: all clean run
